
{% extends 'base.html' %}
{% block title %}SuperShop - Home{% endblock %}

{% block header %}
{% block header %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/labs/lab2/sub3.css') }}">
    <!-- Fake Shop Header -->
    <header class="supershop-header">
        <div class="supershop-header-container">
            <a href="{{ url_for('lab2') }}" class="supershop-back-link">&larr; Back</a>
            <div class="supershop-brand">SuperShopâ„¢</div>
        </div>
        
        <div class="supershop-header-actions">
            <input type="text" placeholder="Search for products..." class="supershop-search">
            
            <div class="supershop-header-container">
                <button class="btn supershop-cart-btn">
                    ðŸ›’ <span class="supershop-cart-badge">0</span>
                </button>
                
                <div class="supershop-user-section">
                    {% if username %}
                    <div class="user-avatar-supershop">
                        {{ username[0]|upper }}
                    </div>
                    <div class="supershop-user-info">
                        <span class="supershop-username">{{ username }}</span>
                        <a href="{{ url_for('lab2_3_logout') }}" class="supershop-logout-link">Sign out</a>
                    </div>
                    {% else %}
                    <button onclick="document.getElementById('loginModal').style.display='flex'" class="btn supershop-login-btn">Login</button>
                    {% endif %}
                </div>
            </div>
        </div>
    </header>
{% endblock %}

{% block content %}
    <main>
        <!-- Promotional Banner -->
        <div class="supershop-hero">
            <h1>Summer Collection 2026</h1>
            <p class="supershop-hero-subtitle">Exclusive deals on vulnerable items. Shop now while stocks last!</p>
            <button class="supershop-hero-btn">Browse Collection</button>
        </div>

        <!-- Product Grid -->
        <h2 class="supershop-section-title">Latest Arrivals</h2>
        
        <div class="card-grid">
            {% for product in products %}
            <div class="card product-card-supershop">
                <div class="product-image-placeholder-supershop">
                    <span>[Image Placeholder]</span>
                </div>
                <div class="supershop-product-content">
                    <h3 class="supershop-product-name">{{ product.name }}</h3>
                    <p class="supershop-product-desc">{{ product.description }}</p>
                </div>
                <div class="supershop-product-footer">
                    <span class="supershop-product-price">${{ product.price }}</span>
                    <button class="btn supershop-add-to-cart">Add to Cart</button>
                </div>
            </div>
            {% endfor %}
        </div>
    </main>

    <!-- Footer with Vulnerable Admin Link -->
    <footer class="footer-supershop">
        <div class="supershop-footer-grid">
            <div>
                <div class="supershop-footer-brand">SuperShop</div>
                <p class="supershop-footer-desc">The world's most vulnerable marketplace.</p>
            </div>
            <div>
                <h4 class="supershop-footer-heading">Shop</h4>
                <ul class="supershop-footer-list">
                    <li>New Arrivals</li>
                    <li>Best Sellers</li>
                    <li>Sale</li>
                </ul>
            </div>
            <div>
                <h4 class="supershop-footer-heading">Support</h4>
                <ul class="supershop-footer-list">
                    <li>Help Center</li>
                    <li>Returns</li>
                    <!-- Vulnerable Link -->
                    <li><a href="{{ url_for('lab2_3_admin') }}" id="admin-link" class="supershop-admin-link">[ Employee Portal ]</a></li>
                </ul>
            </div>
            <div>
                <h4 class="supershop-footer-heading">Newsletter</h4>
                <input type="email" placeholder="Enter email" class="supershop-newsletter-input">
                <button class="btn supershop-subscribe-btn">Subscribe</button>
            </div>
        </div>
        <div class="supershop-footer-copyright">
            &copy; 2026 SuperShop Inc. All rights reserved.
        </div>
    </footer>

    <!-- LOGIN MODAL -->
    <div id="loginModal" class="login-modal-supershop">
        <div class="card supershop-login-modal-card">
            <button onclick="document.getElementById('loginModal').style.display='none'" class="supershop-modal-close-btn">&times;</button>
            <h2 class="supershop-signin-title">Sign In</h2>
            <form action="{{ url_for('lab2_3_login_page') }}" method="POST">
                <div class="supershop-form-group">
                    <label class="supershop-form-label">Username</label>
                    <input type="text" name="username" required class="login-input-supershop">
                </div>
                <div class="supershop-password-group">
                    <label class="supershop-form-label">Password</label>
                    <input type="password" name="password" required class="login-input-supershop">
                </div>
                <button type="submit" class="btn supershop-login-submit-btn">Login</button>
                <div class="supershop-login-hint">
                    Try: <code>user</code> / <code>password</code>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Visible Request in Burp Suite: Checking admin status
        fetch('/lab2/3/api/check_privileges')
            .then(r => r.json())
            .then(data => {
                const link = document.getElementById('admin-link');
                if (link && data.is_admin) {
                     link.style.color = '#22c55e'; // Green if admin
                     link.innerText = '[ Admin Access granted! ]';
                }
            });
    </script>
{% endblock %}
