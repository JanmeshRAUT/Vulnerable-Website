{% extends 'base.html' %}
{% block title %}MegaMart - Online Shopping{% endblock %}

{% block header %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/lab5.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/lab5-utils.css') }}">
<style>
    /* Theme Override: MegaMart (Green) */
    :root {
        --primary: #10b981;
        --primary-hover: #059669;
        --accent: #34d399;
    }
    .tech-hero {
        background: linear-gradient(135deg, #10b981 0%, #047857 100%);
    }
    .stock-checker {
        background: #f0fdf4;
        border: 2px solid #86efac;
        border-radius: 1rem;
        padding: 2rem;
        margin: 2rem 0;
    }
    .stock-result {
        background: white;
        border: 1px solid #d1d5db;
        border-radius: 0.5rem;
        padding: 1.5rem;
        margin-top: 1rem;
        font-family: 'Courier New', monospace;
        white-space: pre-wrap;
        color: #1f2937;
    }
</style>
{% endblock %}

{% block layout_container %}
<nav class="tech-nav glass">
    <div class="container animate-fade-in lab5-container-fluid tech-nav-content">
        <a href="{{ url_for('lab6_1') }}" class="tech-brand">
            <span style="font-size: 1.75rem;">ðŸ›’</span>
            <span style="color: #059669;">MegaMart</span>
        </a>
        <div class="nav-actions">
            <a href="{{ url_for('lab6') }}" class="btn-tech-outline">Exit Lab</a>
        </div>
    </div>
</nav>

<header class="tech-hero animate-fade-in">
    <div class="hero-content">
        <span class="hero-subtitle">Your Neighborhood Superstore</span>
        <h1>Everything You Need.<br>One Stop Shop.</h1>
        <p>Fresh groceries, electronics, home goods, and more. Check real-time stock availability across all locations.</p>
    </div>
</header>

<main class="container animate-fade-in lab5-container-max">
    <div class="tech-grid">
        {% for product in products %}
        <div class="tech-card">
            <div class="tech-card-img-wrapper">
                <img src="{{ product.image }}" alt="{{ product.name }}" class="tech-card-img">
            </div>
            <div class="tech-card-body">
                <h3 class="tech-title">{{ product.name }}</h3>
                <p class="tech-desc">{{ product.description }}</p>
                <div class="product-actions">
                    <div class="tech-price">${{ product.price }}</div>
                    <button class="btn-tech-outline btn-cart-mini" onclick="checkStock({{ product.id }})">Check Stock</button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Stock Checker Section -->
    <div class="stock-checker">
        <h2 style="color: #047857; margin-bottom: 1rem;">ðŸ“¦ Stock Availability Checker</h2>
        <p style="color: #065f46; margin-bottom: 1.5rem;">Enter product ID and store location to check inventory.</p>
        
        <form id="stockForm" style="display: flex; gap: 1rem; flex-wrap: wrap;">
            <input type="number" id="productId" placeholder="Product ID" 
                   style="flex: 1; min-width: 150px; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 0.5rem;" required>
            <input type="text" id="storeId" placeholder="Store ID (e.g., 1)" 
                   style="flex: 1; min-width: 150px; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 0.5rem;" required>
            <button type="submit" class="btn-tech-primary" style="background: #10b981;">
                Check Availability
            </button>
        </form>

        <div id="stockResult" class="stock-result" style="display: none;"></div>
    </div>
</main>

<script>
function checkStock(productId) {
    document.getElementById('productId').value = productId;
    document.getElementById('storeId').focus();
}

document.getElementById('stockForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const productId = document.getElementById('productId').value;
    const storeId = document.getElementById('storeId').value;
    
    const resultDiv = document.getElementById('stockResult');
    resultDiv.style.display = 'block';
    resultDiv.textContent = 'Checking inventory...';
    
    try {
        const response = await fetch('/lab6/1/check-stock', {
            method: 'POST',
            headers: {'Content-Type': 'application/x-www-form-urlencoded'},
            body: `productId=${productId}&storeId=${encodeURIComponent(storeId)}`
        });
        
        const data = await response.text();
        resultDiv.textContent = data;
    } catch (error) {
        resultDiv.textContent = 'Error checking stock: ' + error.message;
    }
});
</script>

<footer class="tech-footer">
    <p>&copy; 2025 MegaMart Inc.</p>
</footer>
{% endblock %}
