{% extends 'base.html' %}
{% block title %}Inventory Search - NexusRetail{% endblock %}

{% block header %}
    <div class="nx-search-header">
        <div class="container">
            <div class="nx-header-flex">
                <a href="{{ url_for('home') }}" class="btn btn-secondary">&larr; Back</a>
                <h2>Module 7: SQL Injection</h2>
            </div>
            <h1 class="nx-title">Nexus Inventory</h1>
            <form action="{{ url_for('lab7') }}" method="POST">
                <div class="search-pill glass-panel">
                    <span class="nx-search-icon">üîç</span>
                    <input type="text" name="search" placeholder="Search products, SKUs, or categories..." autocomplete="off">
                    <button type="submit" class="btn btn-shophub nx-search-btn">SEARCH</button>
                </div>
            </form>
        </div>
    </div>
{% endblock %}

{% block content %}
    {% if products %}
        <div class="nx-results-info">
            Showing {{ products|length }} results for your query.
        </div>
        <div class="card-grid">
            {% for product in products %}
            <div class="card nx-card">
                <div class="nx-card-image">
                    üì¶
                </div>
                <div class="nx-card-body">
                    <h3 class="nx-product-title">{{ product.name }}</h3>
                    <p class="nx-product-desc">{{ product.description }}</p>
                    <div class="nx-product-footer">
                        <span class="nx-product-price">${{ product.price }}</span>
                        <span class="nx-product-sku">SKU: {{ product.id | string | upper | ljust(6, '0') }}</span>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="nx-no-results">
            <div class="nx-no-results-icon">üîé</div>
            <h3>No results found</h3>
            <p>Try searching for "T-Shirt" or "Mug"</p>
        </div>
    {% endif %}

    <div class="nx-developer-note">
        <strong>Developer Note:</strong> Legacy search API active. SQL optimizations in progress. 
        <br>Current Query: <code>SELECT * FROM products WHERE name LIKE '%{{ request.form.get('search', '') }}%'</code>
    </div>
{% endblock %}
